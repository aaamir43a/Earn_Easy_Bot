<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earn Easy</title>
    <!-- টেলিগ্রাম এবং বিজ্ঞাপন SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='9646545' data-sdk='show_9646545'></script>
    
    <!-- Firebase SDKs (Compat version for easier use) -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>

    <!-- CSS স্টাইল (আগের মতোই) -->
    <style>
        /* সম্পূর্ণ CSS কোড এখানে থাকবে */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        :root{--primary-color:#149A9B;--accent-color:#FFB800;--text-color:#2C3E50;--light-text-color:#7f8c8d;--background-color:#F7F9FA;--card-bg:#FFFFFF;--success-color:#27ae60;--danger-color:#e74c3c;--nav-bg:#2C3E50}html{scroll-behavior:smooth}body{font-family:'Poppins',sans-serif;margin:0;background-color:var(--background-color);color:var(--text-color)}.loader-wrapper{display:flex;justify-content:center;align-items:center;min-height:100vh;font-size:1.2em;color:var(--primary-color);padding:20px;text-align:center}.app-container{max-width:450px;margin:auto;background-color:var(--background-color);min-height:100vh;position:relative;padding-bottom:70px;overflow-x:hidden;display:none}body.loaded .loader-wrapper{display:none}body.loaded .app-container{display:block}.page{display:none;padding:20px;box-sizing:border-box}.page.active{display:block}.header{background-color:var(--primary-color);color:#fff;padding:20px;display:flex;align-items:center;border-bottom-left-radius:25px;border-bottom-right-radius:25px;position:relative;margin:-20px -20px 25px}.header img{width:50px;height:50px;border-radius:50%;border:2px solid var(--card-bg);margin-right:15px}.header .user-info{flex-grow:1}.header .user-info h1{margin:0;font-size:1.2em;font-weight:600}.header .user-info p{margin:0;font-size:1em;opacity:.9}#home-page{padding:0}#home-page>.header{margin:0 0 20px;border-radius:0}.main-title{text-align:center;color:var(--primary-color);font-size:1.8em;font-weight:600;margin-bottom:25px;margin-top:0}
    </style>
</head>
<body>
    
    <div class="loader-wrapper">
        <div id="loader">Loading App...</div>
    </div>

    <div class="app-container">
        <!-- আপনার অ্যাপের সম্পূর্ণ HTML অংশ এখানে থাকবে (আগের কোড থেকে কপি করুন) -->
        <!-- হোম পেজ, আর্ন পেজ, উইথড্র পেজ, প্রোফাইল পেজ ইত্যাদি -->
    </div>

    <script>
        // ধাপ ১ থেকে পাওয়া আপনার Firebase কনফিগারেশন এখানে পেস্ট করুন
        const firebaseConfig = {
        apiKey: "AIzaSyCJ2K5oH8Zbeqy36VF9Vh9j8iUyqWbSxhE",
        authDomain: "earn-easy-ot.firebaseapp.com",
        projectId: "earn-easy-ot",
        storageBucket: "earn-easy-ot.firebasestorage.app",
        messagingSenderId: "831993475766",
        appId: "1:831993475766:web:7c60ba5b12cf66971dac17"
    };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        // --- এই দুটি জায়গা আপনাকে অবশ্যই পরিবর্তন করতে হবে ---
        // ১. উপরের firebaseConfig অবজেক্টটি আপনার নিজের কনফিগারেশন দিয়ে পরিবর্তন করুন।
        // ২. নিচের MY_BOT_USERNAME-এ আপনার টেলিগ্রাম বটের ইউজারনেম দিন।
        const MY_BOT_USERNAME = 'EarnEasyOfficial_bot';
        // ---------------------------------------------

        // Firebase চালু করুন
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const tg = window.Telegram.WebApp;

        const loaderEl = document.getElementById('loader');
        let currentUserData = null;

        tg.ready(() => {
            auth.signInAnonymously().catch(error => {
                loaderEl.textContent = `Firebase Auth Error: ${error.message}`;
            });

            auth.onAuthStateChanged(firebaseUser => {
                if (firebaseUser) {
                    mainApp(firebaseUser).catch(error => {
                        loaderEl.textContent = `App Execution Error: ${error.message}`;
                    });
                }
            });
        });

        async function mainApp(firebaseUser) {
            if (!tg.initDataUnsafe || !tg.initDataUnsafe.user) {
                throw new Error("Telegram user data not available.");
            }

            const user = tg.initDataUnsafe.user;
            const userRef = db.collection('users').doc(String(user.id));
            
            userRef.onSnapshot(async (doc) => {
                let docData = doc.data();
                if (!doc.exists) {
                    const startParam = tg.initDataUnsafe.start_param;
                    const referred_by = startParam && startParam !== user.id ? startParam : null;
                    
                    docData = {
                        id: user.id, first_name: user.first_name || 'User', last_name: user.last_name || '', username: user.username || 'N/A',
                        available_balance: 0.00, total_earnings: 0.00, lifetime_ads_watched: 0, daily_ads_completed: 0,
                        last_ad_date: new Date().toISOString().split('T')[0], referral_count: 0, referred_by: referred_by,
                        join_date: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    await userRef.set(docData);
                    
                    if(referred_by){
                        const referrerRef = db.collection('users').doc(referred_by);
                        const referrerDoc = await referrerRef.get();
                        if(referrerDoc.exists){
                           await referrerRef.update({ referral_count: firebase.firestore.FieldValue.increment(1) });
                        }
                    }
                } else {
                    const today = new Date().toISOString().split('T')[0];
                    if(docData.last_ad_date !== today){
                        await userRef.update({ daily_ads_completed: 0, last_ad_date: today });
                        docData.daily_ads_completed = 0;
                    }
                }
                
                currentUserData = docData;
                if (!document.body.classList.contains('loaded')) {
                    document.body.classList.add('loaded');
                    setupEventListeners();
                }
                updateAllUI(currentUserData);

            }, error => {
                loaderEl.textContent = `Firestore Snapshot Error: ${error.message}`;
            });
        }
        
        function updateAllUI(user) {
            // এই ফাংশনটি আপনার অ্যাপের সব তথ্য আপডেট করবে
            // এটি একটি উদাহরণ, আপনার HTML-এর আইডি অনুযায়ী এটি পরিবর্তন হতে পারে
            const fullName = `${user.first_name || ''} ${user.last_name || ''}`.trim();
            document.querySelectorAll('.user-dynamic-name').forEach(el => el.textContent = fullName);
            // ... বাকি সব UI আপডেট ...
        }

        function setupEventListeners() {
            // সব বাটনের ক্লিক ইভেন্ট এখানে সেটআপ হবে
            const earnStartTaskBtn = document.getElementById('earn-start-task-btn');
            if (earnStartTaskBtn) {
                earnStartTaskBtn.addEventListener('click', () => startTask('View'));
            }
            // ... অন্যান্য সব বাটন ...
        }

        async function startTask(taskType) {
            // বিজ্ঞাপন দেখানোর কোড এখানে থাকবে
            alert("Start Task button clicked!");
        }

    </script>
</body>
</html>
