<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Auto Ads Show</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1f1c2c, #928dab);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            text-align: center;
            background: linear-gradient(to right, #232526, #414345);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
            width: 320px;
        }

        .container h1 {
            font-size: 24px;
            background: linear-gradient(to right, #00c6ff, #0072ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .developer {
            font-size: 13px;
            background: linear-gradient(45deg, #11998e, #38ef7d);
            padding: 6px 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: inline-block;
            color: #fff;
            font-weight: bold;
            box-shadow: 0 3px 0 #0e6b5f;
            cursor: pointer;
        }

        .developer:hover {
            opacity: 0.9;
        }

        .stats p,
        .user-info p {
            font-size: 15px;
            margin: 6px 0;
        }

        .progress-container {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 12px auto;
        }

        .progress-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-circle-track {
            fill: none;
            stroke-width: 8;
            stroke: #ff9800;
            opacity: 0.3;
        }

        #green-progress {
            fill: none;
            stroke-width: 8;
            stroke: #00ff00;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }

        .progress-text-container {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #ads-progress {
            font-size: 18px;
            font-weight: bold;
            color: #ffeb3b;
        }

        .buttons button {
            width: 90%;
            margin: 8px 0;
            padding: 12px;
            font-size: 15px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            background: linear-gradient(to bottom, #43cea2, #185a9d);
            color: white;
            box-shadow: 0 5px 0 #0e4c7d;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .buttons button:hover {
            transform: translateY(-2px);
            background: linear-gradient(to bottom, #f7971e, #ffd200);
            box-shadow: 0 7px 0 #d17d00;
        }

        .buttons button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Auto Ads Show Bot</h1>
        <div class="developer" onclick="window.location.href='https://t.me/amir47812'">
            Developer by Amir Hossain
        </div>
        <div class="user-info">
            <p>Welcome, <span id="user-name"></span></p>
        </div>
        <div class="stats">
            <p>Watched Ads: <span id="watched-ads">0</span></p>
        </div>
        <div class="progress-container">
            <svg class="progress-svg" viewBox="0 0 100 100">
                <circle class="progress-circle-track" cx="50" cy="50" r="45"></circle>
                <circle id="green-progress" cx="50" cy="50" r="45"></circle>
            </svg>
            <div class="progress-text-container">
                <span id="ads-progress">0%</span>
            </div>
        </div>
        <div class="buttons">
            <button onclick="watchAd()">üé¨ Watch Ads</button>
            <button id="auto-ad-btn" onclick="startAutoAds()">‚öôÔ∏è Auto Show Ads</button>
            <button id="stop-auto-btn" onclick="stopAutoAds()" disabled>‚õî Stop Auto Ads</button>
        </div>
    </div>
    
    <script>
        let watchedAdsCount = 0;
        let isAutoAdsRunning = false;
        let autoAdTimeout;

        function setUserName() {
            const userNameSpan = document.getElementById("user-name");
            try {
                const tg = window.Telegram.WebApp;
                const user = tg.initDataUnsafe.user;
                if (user && user.first_name) {
                    const fullName = `${user.first_name} ${user.last_name || ''}`.trim();
                    userNameSpan.textContent = fullName;
                } else {
                    userNameSpan.textContent = "Guest";
                }
            } catch (error) {
                userNameSpan.textContent = "@exampleUser";
            }
        }

        function checkAndResetCounter() {
            const todayUTC = new Date().toISOString().slice(0, 10);
            const lastVisitUTC = localStorage.getItem('lastAdDate');
            if (lastVisitUTC !== todayUTC) {
                watchedAdsCount = 0;
                localStorage.setItem('watchedAdsCount', '0');
                localStorage.setItem('lastAdDate', todayUTC);
            } else {
                watchedAdsCount = parseInt(localStorage.getItem('watchedAdsCount')) || 0;
            }
        }

        function watchAd() {
            return new Promise((resolve, reject) => {
                // The structure of the function is preserved, but the ad call is removed.
                // Instead, we directly perform the success actions.
                try {
                    checkAndResetCounter();
                    watchedAdsCount++;
                    localStorage.setItem('watchedAdsCount', watchedAdsCount);
                    localStorage.setItem('lastAdDate', new Date().toISOString().slice(0, 10));
                    updateUI();
                    resolve(); // Resolve the promise to indicate success.
                } catch (error) {
                    console.error("Error in watchAd function:", error);
                    reject(error); // Reject if any error occurs.
                }
            });
        }

        function updateUI() {
            document.getElementById('watched-ads').textContent = watchedAdsCount;
            updateProgressCircle();
        }

        function updateProgressCircle() {
            const textPercent = Math.floor(watchedAdsCount / 10);
            document.getElementById('ads-progress').textContent = `${textPercent}%`;
            const greenProgressElement = document.getElementById('green-progress');
            const radius = greenProgressElement.r.baseVal.value;
            const circumference = 2 * Math.PI * radius;
            const progress = Math.min(watchedAdsCount / 1000, 1);
            const offset = circumference * (1 - progress);
            greenProgressElement.style.strokeDasharray = circumference;
            greenProgressElement.style.strokeDashoffset = offset;
        }

        function autoAdLoop() {
            if (!isAutoAdsRunning) return;
            watchAd()
                .then(() => {
                    if (isAutoAdsRunning) autoAdTimeout = setTimeout(autoAdLoop, 2000);
                })
                .catch(error => {
                    console.error("Ad failed:", error);
                    if (isAutoAdsRunning) autoAdTimeout = setTimeout(autoAdLoop, 2000);
                });
        }

        function startAutoAds() {
            if (isAutoAdsRunning) return;
            isAutoAdsRunning = true;
            document.getElementById('auto-ad-btn').disabled = true;
            document.getElementById('stop-auto-btn').disabled = false;
            autoAdLoop();
        }

        function stopAutoAds() {
            isAutoAdsRunning = false;
            clearTimeout(autoAdTimeout);
            document.getElementById('auto-ad-btn').disabled = false;
            document.getElementById('stop-auto-btn').disabled = true;
        }

        document.addEventListener('DOMContentLoaded', () => {
            setUserName();
            checkAndResetCounter();
            updateUI();
        });
    </script>
</body>

</html>