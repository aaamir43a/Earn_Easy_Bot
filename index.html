 <!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earn Easy</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='9646545' data-sdk='show_9646545'></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        :root{--primary-color:#149A9B;--accent-color:#FFB800;--text-color:#2C3E50;--light-text-color:#7f8c8d;--background-color:#F7F9FA;--card-bg:#FFFFFF;--success-color:#27ae60;--danger-color:#e74c3c;--nav-bg:#2C3E50}
        html{scroll-behavior:smooth}
        body{font-family:'Poppins',sans-serif;margin:0;background-color:var(--background-color);color:var(--text-color)}
        .loader-wrapper{display:flex;justify-content:center;align-items:center;flex-direction:column;min-height:100vh;font-size:1.2em;color:var(--primary-color);padding:20px;text-align:center}
        .loader-wrapper pre{background:#ffebee;border:1px solid #e57373;padding:15px;border-radius:8px;color:#c62828;font-size:11px;white-space:pre-wrap;word-wrap:break-word;text-align:left;max-width:100%;box-sizing:border-box;margin-top:20px}
        .app-container{max-width:450px;margin:auto;background-color:var(--background-color);min-height:100vh;position:relative;padding-bottom:70px;overflow-x:hidden;display:none}
        body.loaded .loader-wrapper{display:none}
        body.loaded .app-container{display:block}
        .page{display:none;padding:20px;box-sizing:border-box}.page.active{display:block}
        .header{background-color:var(--primary-color);color:#fff;padding:20px;display:flex;align-items:center;border-bottom-left-radius:25px;border-bottom-right-radius:25px;position:relative;margin:-20px -20px 25px}
        .header img{width:50px;height:50px;border-radius:50%;border:2px solid var(--card-bg);margin-right:15px}
        .header .user-info{flex-grow:1}.header .user-info h1{margin:0;font-size:1.2em;font-weight:600}.header .user-info p{margin:0;font-size:1em;opacity:.9}
        #home-page{padding:0}#home-page>.header{margin:0 0 20px;border-radius:0}#home-page .main-content{padding:20px}
        .main-title{text-align:center;color:var(--primary-color);font-size:1.8em;font-weight:600;margin-bottom:25px;margin-top:0}
        .card,.stat-card,.withdraw-card{background-color:var(--card-bg);border-radius:16px;padding:25px;box-shadow:0 4px 15px rgba(0,0,0,.06);border:1px solid #eaecee;margin-bottom:20px;text-align:left}
        #home-page .welcome-card h2{margin-top:0;margin-bottom:5px;font-size:1.4em;font-weight:600;color:var(--text-color)}
        #home-page .welcome-card p{margin-top:0;margin-bottom:20px;color:var(--light-text-color)}
        #home-page .welcome-card .earn-now-btn{background-color:var(--primary-color);color:#fff;border:none;padding:12px 30px;border-radius:12px;font-size:1em;cursor:pointer;font-weight:500}
        #home-page .welcome-card .illustration{text-align:center;margin-top:20px;height:160px;border-radius:12px;overflow:hidden}
        #home-page .welcome-card .illustration img{width:100%;height:100%;object-fit:cover}
        #home-page .stats-grid{display:flex;flex-direction:column;gap:15px}
        #home-page .stat-card{color:var(--text-color)}
        #home-page .stat-card.earnings{border-left:5px solid var(--primary-color)}
        #home-page .stat-card.ads-watched{border-left:5px solid var(--accent-color)}
        #home-page .stat-card .value{font-size:2em;font-weight:700;margin:5px 0;color:var(--text-color)}
        #home-page .stat-card .label{font-size:.9em;color:var(--light-text-color)}
        .bottom-nav{position:fixed;bottom:0;left:0;right:0;max-width:450px;margin:auto;background-color:var(--nav-bg);display:flex;justify-content:space-around;padding:10px 0;box-shadow:0 -2px 10px rgba(0,0,0,.1);z-index:100}
        .nav-item{display:flex;flex-direction:column;align-items:center;color:var(--light-text-color);text-decoration:none;font-size:.8em;cursor:pointer;transition:color .2s}
        .nav-item.active{color:var(--primary-color)}
        .nav-item svg{width:24px;height:24px;margin-bottom:3px;fill:currentColor}
        /* এখানে আপনার বাকি CSS কোড যোগ করুন */
    </style>
</head>
<body>
    <div class="loader-wrapper">
        <div id="loader-text">Loading App...</div>
        <pre id="error-log" style="display:none;"></pre>
    </div>
    <div class="app-container">
        <!-- হোম পেজ -->
        <div id="home-page" class="page active">
            <header class="header">
                <img src="" class="dynamic-profile-pic" alt="Profile">
                <div class="user-info">
                    <h1 class="user-dynamic-name"></h1>
                    <p>Balance: <span class="header-available-balance">0.00</span></p>
                </div>
            </header>
            <main class="main-content">
                <div class="card welcome-card">
                    <h2>Ready to Earn?</h2>
                    <p>Complete your daily tasks and watch your earnings grow.</p>
                    <button id="home-start-earning" class="earn-now-btn">Start Earning</button>
                    <div class="illustration">
                        <img src="https://i.ibb.co/chwt44Nq/Background-photo.png" alt="Illustration">
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card earnings">
                        <div class="label">Total Earnings</div>
                        <div id="home-total-earnings" class="value">0.00</div>
                    </div>
                    <div class="stat-card ads-watched">
                        <div class="label">Total Ads Watched</div>
                        <div id="home-total-ads" class="value">0</div>
                    </div>
                </div>
            </main>
        </div>
        <!-- আর্ন পেজ -->
        <div id="earn-page" class="page">
            <h1 class="main-title">Earn Rewards</h1>
            <!-- আর্ন পেজের বাকি কন্টেন্ট এখানে থাকবে -->
        </div>
        <!-- উইথড্র পেজ -->
        <div id="withdraw-page" class="page">
            <h1 class="main-title">Withdraw</h1>
            <!-- উইথড্র পেজের বাকি কন্টেন্ট এখানে থাকবে -->
        </div>
        <!-- প্রোফাইল পেজ -->
        <div id="profile-page" class="page">
            <h1 class="main-title">Profile</h1>
            <!-- প্রোফাইল পেজের বাকি কন্টেন্ট এখানে থাকবে -->
        </div>
        <!-- নেভিগেশন বার -->
        <nav class="bottom-nav">
            <a data-page="home-page" class="nav-item active"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z"/></svg><span>Home</span></a>
            <a data-page="earn-page" class="nav-item"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm-1 14H5c-.55 0-1-.45-1-1V8h16v9c0 .55-.45 1-1 1zm-5-5H9v2h6v-2z"/></svg><span>Earn</span></a>
            <a data-page="withdraw-page" class="nav-item"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 4h18v2H3V4zm0 15h18v2H3v-2zm8-11.41L8.41 10 7 11.41 12 16.41l5-5L15.59 10 13 12.59V7h-2v5.59z"/></svg><span>Withdraw</span></a>
            <a data-page="profile-page" class="nav-item"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg><span>Profile</span></a>
        </nav>
    </div>
    <script>
        // আপনার দেওয়া Firebase কনফিগারেশন
        const firebaseConfig = {
          apiKey: "AIzaSyCJ2K5oH8Zbeqy36VF9Vh9j8iUyqWbSxhE",
          authDomain: "earn-easy-ot.firebaseapp.com",
          projectId: "earn-easy-ot",
          storageBucket: "earn-easy-ot.firebasestorage.app",
          messagingSenderId: "831993475766",
          appId: "1:831993475766:web:7c60ba5b12cf66971dac17"
        };
        
        // আপনার দেওয়া বটের ইউজারনেম
        const MY_BOT_USERNAME = 'EarnEasyOfficial_bot';

        const loaderText = document.getElementById('loader-text');
        const errorLog = document.getElementById('error-log');

        function showError(message, error = '') {
            loaderText.textContent = message;
            errorLog.style.display = 'block';
            errorLog.textContent = error.toString();
            console.error(message, error);
        }

        try {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            const auth = firebase.auth();
            const tg = window.Telegram.WebApp;

            tg.ready(async () => {
                try {
                    loaderText.textContent = "Step 1: Authenticating...";
                    await auth.signInAnonymously();
                    
                    loaderText.textContent = "Step 2: Waiting for Auth State...";
                    auth.onAuthStateChanged(async (firebaseUser) => {
                        if (firebaseUser) {
                            try {
                                loaderText.textContent = "Step 3: Fetching Telegram User Data...";
                                if (!tg.initDataUnsafe || !tg.initDataUnsafe.user) {
                                    throw new Error("Telegram user data not found.");
                                }
                                const user = tg.initDataUnsafe.user;
                                const userRef = db.collection('users').doc(String(user.id));
                                
                                loaderText.textContent = "Step 4: Accessing Database...";
                                userRef.onSnapshot(async (doc) => {
                                    loaderText.textContent = "Step 5: Processing Data...";
                                    let userData = doc.data();

                                    if (!doc.exists) {
                                        const startParam = tg.initDataUnsafe.start_param;
                                        const referred_by = (startParam && startParam !== String(user.id)) ? startParam : null;

                                        userData = {
                                            id: user.id,
                                            first_name: user.first_name || 'User',
                                            last_name: user.last_name || '',
                                            username: user.username || 'N/A',
                                            available_balance: 0.00,
                                            total_earnings: 0.00,
                                            lifetime_ads_watched: 0,
                                            daily_ads_completed: 0,
                                            last_ad_date: new Date().toISOString().split('T')[0],
                                            referral_count: 0,
                                            referred_by: referred_by,
                                            join_date: firebase.firestore.FieldValue.serverTimestamp()
                                        };
                                        await userRef.set(userData);

                                        if (referred_by) {
                                            const referrerRef = db.collection('users').doc(referred_by);
                                            const referrerDoc = await referrerRef.get();
                                            if (referrerDoc.exists) {
                                               await referrerRef.update({ referral_count: firebase.firestore.FieldValue.increment(1) });
                                            }
                                        }
                                    } else {
                                        const today = new Date().toISOString().split('T')[0];
                                        if (userData.last_ad_date !== today) {
                                            await userRef.update({ daily_ads_completed: 0, last_ad_date: today });
                                            userData.daily_ads_completed = 0;
                                        }
                                    }

                                    if (!document.body.classList.contains('loaded')) {
                                        document.body.classList.add('loaded');
                                        setupEventListeners();
                                    }
                                    updateAllUI(userData);

                                }, (error) => {
                                    showError("Error listening to database.", error);
                                });

                            } catch(error) {
                                showError("Error during data processing.", error);
                            }
                        } else {
                            showError("Firebase user is not authenticated.");
                        }
                    });

                } catch (error) {
                    showError("Error during app initialization.", error);
                }
            });

        } catch (error) {
            showError("A critical error initializing Firebase.", error);
        }

        function updateAllUI(user) {
            if (!user) return;
            const fullName = `${user.first_name || ''} ${user.last_name || ''}`.trim();
            document.querySelectorAll('.user-dynamic-name').forEach(el => el.textContent = fullName);
            
            const profilePicUrl = (tg.initDataUnsafe.user.photo_url) ? tg.initDataUnsafe.user.photo_url : 'https://i.ibb.co/RkQsb051/Profile-Picture.png';
            document.querySelectorAll('.dynamic-profile-pic').forEach(el => el.src = profilePicUrl);
            
            const fAvailable = (user.available_balance || 0).toFixed(2);
            const fTotal = (user.total_earnings || 0).toFixed(2);
            document.querySelectorAll('.header-available-balance').forEach(el => el.textContent = fAvailable);
            document.getElementById('home-total-earnings').textContent = fTotal;
            
            const lifetimeAds = user.lifetime_ads_watched || 0;
            document.getElementById('home-total-ads').textContent = lifetimeAds;
        }

        function setupEventListeners() {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetPageId = item.getAttribute('data-page');
                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                    const targetPage = document.getElementById(targetPageId);
                    if (targetPage) {
                        targetPage.classList.add('active');
                    }
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                });
            });

            document.getElementById('home-start-earning').addEventListener('click', () => {
                document.querySelector('.nav-item[data-page="earn-page"]').click();
            });
        }

    </script>
</body>
</html>
